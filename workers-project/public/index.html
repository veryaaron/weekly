<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Weekly Feedback</title>

    <!-- Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=2.4">

    <!-- Configuration -->
    <script src="config.js?v=2.4"></script>
    <script src="questions.js?v=2.4"></script>
    <script src="app.js?v=2.4"></script>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <a href="#" class="logo" onclick="resetToStart(); return false;" title="Return to start">
                <svg class="logo-icon" viewBox="0 0 32 32" width="32" height="32">
                    <path d="M0 32 Q16 32 16 16 Q16 0 32 0" fill="none" stroke="#ffd618" stroke-width="3"/>
                </svg>
                <span class="logo-text">Weekly Feedback</span>
            </a>
            <!-- Admin gear icon - only shown for admins via JS -->
            <button class="admin-toggle" id="adminToggle" onclick="toggleAdminPanel()" title="Admin Tools" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                </svg>
            </button>
        </header>

        <!-- Admin Panel (slide-down, hidden by default) -->
        <div class="admin-panel" id="adminPanel">
            <div class="admin-panel-content">
                <h3>Manager Tools</h3>
                <p>Generate the weekly summary report</p>
                <button type="button" class="btn-admin" id="generateReportBtn" onclick="generateReport(event)">
                    Generate Report
                </button>
                <div id="reportStatus"></div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main">
            <!-- Auth Card -->
            <div class="card" id="authCard">
                <div class="card-content auth-content">
                    <h2>Welcome</h2>
                    <p>Sign in with your company Google account to submit your weekly feedback.</p>

                    <div id="signinLoading" class="loading-state">
                        <span class="spinner"></span>
                        <span>Loading...</span>
                    </div>

                    <div id="g_id_signin"></div>
                    <div id="authError"></div>

                    <div id="authHelp" class="auth-help" style="display: none;">
                        <button class="btn-text" onclick="location.reload()">Having trouble? Refresh page</button>
                    </div>
                </div>
            </div>

            <!-- Form Card -->
            <div class="card" id="formCard" style="display: none;">
                <form id="feedbackForm">
                    <!-- Progress -->
                    <div class="progress">
                        <div class="progress-text">
                            <span id="progressCount">Question 1 of 6</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                    </div>

                    <!-- Questions -->
                    <div class="questions">
                        <!-- Q1: Accomplishments -->
                        <div class="question active" id="questionAccomplishments">
                            <label class="question-title" for="accomplishments">What did you accomplish this week?</label>
                            <p class="question-hint" id="hintAccomplishments">Key wins, completed tasks, or progress made</p>
                            <textarea
                                id="accomplishments"
                                name="accomplishments"
                                placeholder="e.g., Shipped the new dashboard, closed 3 deals, finished user research..."
                                required
                            ></textarea>
                            <div class="question-footer">
                                <span class="char-count" id="accomplishmentsCount">0 characters</span>
                            </div>
                            <div class="question-nav">
                                <button type="button" class="btn-primary" onclick="nextQuestion('accomplishments')">Continue</button>
                            </div>
                        </div>

                        <!-- Q2: Previous Week Progress (conditional) -->
                        <div class="question" id="questionPreviousWeekProgress">
                            <label class="question-title" for="previousWeekProgress">How did last week's priorities go?</label>
                            <div class="previous-week-recall" id="previousWeekSummary"></div>
                            <p class="question-hint" id="hintPreviousWeekProgress">Update on what you planned to do</p>
                            <textarea
                                id="previousWeekProgress"
                                name="previousWeekProgress"
                                placeholder="e.g., Completed the API integration, still working on docs..."
                            ></textarea>
                            <div class="question-footer">
                                <span class="char-count" id="previousWeekProgressCount">0 characters</span>
                            </div>
                            <div class="question-nav">
                                <button type="button" class="btn-secondary" onclick="prevQuestion('previousWeekProgress')">Back</button>
                                <button type="button" class="btn-primary" onclick="nextQuestion('previousWeekProgress')">Continue</button>
                            </div>
                        </div>

                        <!-- Q3: Blockers -->
                        <div class="question" id="questionBlockers">
                            <label class="question-title" for="blockers">Any blockers or challenges?</label>
                            <p class="question-hint" id="hintBlockers">What's slowing you down or needs attention</p>
                            <textarea
                                id="blockers"
                                name="blockers"
                                placeholder="e.g., Waiting on API access, need budget approval..."
                                required
                            ></textarea>
                            <div class="question-footer">
                                <span class="char-count" id="blockersCount">0 characters</span>
                            </div>
                            <div class="question-nav">
                                <button type="button" class="btn-secondary" onclick="prevQuestion('blockers')">Back</button>
                                <button type="button" class="btn-primary" onclick="nextQuestion('blockers')">Continue</button>
                            </div>
                        </div>

                        <!-- Q4: Priorities -->
                        <div class="question" id="questionPriorities">
                            <label class="question-title" for="priorities">What are your priorities next week?</label>
                            <p class="question-hint" id="hintPriorities">Top focus areas for the coming week</p>
                            <textarea
                                id="priorities"
                                name="priorities"
                                placeholder="e.g., Launch beta, focus on Q1 targets, complete research..."
                                required
                            ></textarea>
                            <div class="question-footer">
                                <span class="char-count" id="prioritiesCount">0 characters</span>
                            </div>
                            <div class="question-nav">
                                <button type="button" class="btn-secondary" onclick="prevQuestion('priorities')">Back</button>
                                <button type="button" class="btn-primary" onclick="nextQuestion('priorities')">Continue</button>
                            </div>
                        </div>

                        <!-- Q5: Shoutouts -->
                        <div class="question" id="questionShoutouts">
                            <label class="question-title" for="shoutouts">Anyone to recognize this week?</label>
                            <p class="question-hint" id="hintShoutouts">Give a shoutout to a teammate (optional)</p>
                            <textarea
                                id="shoutouts"
                                name="shoutouts"
                                placeholder="e.g., Thanks to Sarah for helping debug the API issue..."
                            ></textarea>
                            <div class="question-footer">
                                <span class="char-count" id="shoutoutsCount">0 characters</span>
                            </div>
                            <div class="question-nav">
                                <button type="button" class="btn-secondary" onclick="prevQuestion('shoutouts')">Back</button>
                                <button type="button" class="btn-primary" id="generateAIBtn" onclick="nextQuestion('shoutouts')">Continue</button>
                            </div>
                        </div>

                        <!-- Q6: AI Follow-up -->
                        <div class="question" id="questionAiFollowUp">
                            <label class="question-title" for="aiFollowUp">One more thing...</label>
                            <p class="question-hint" id="aiQuestionHint">Loading your personalized question...</p>
                            <textarea
                                id="aiFollowUp"
                                name="aiFollowUp"
                                placeholder="Your thoughts..."
                                required
                            ></textarea>
                            <div class="question-footer">
                                <span class="char-count" id="aiFollowUpCount">0 characters</span>
                            </div>
                            <div class="question-nav">
                                <button type="button" class="btn-secondary" onclick="prevQuestion('aiFollowUp')">Back</button>
                                <button type="submit" class="btn-primary btn-submit" id="submitBtn">Submit</button>
                            </div>
                        </div>

                        <!-- Success -->
                        <div class="question success-screen" id="successScreen" style="display: none;">
                            <div class="success-content">
                                <div class="success-icon">âœ“</div>
                                <h2>Thank you!</h2>
                                <p>Your feedback has been submitted.</p>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Sign out link - subtle, at bottom -->
                <div class="card-footer">
                    <button class="btn-text btn-signout" onclick="signOut()">Sign out</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Hidden user data elements -->
    <div id="userName" style="display:none;"></div>
    <div id="userEmail" style="display:none;"></div>
    <img id="userAvatar" style="display:none;" src="" alt="">
</body>
</html>
